<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Ashes | Ramadan Tracker</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸŒ™</text></svg>">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Reem+Kufi:wght@400;700&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
        import { getFirestore, collection, doc, addDoc, setDoc, deleteDoc, onSnapshot, query } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

        // --- Firebase Configuration ---
const firebaseConfig = {
  apiKey: "AIzaSyCF04TLqqjLz1olCsjaA3PdATwqbyd5aNw",
  authDomain: "ashes-trac.firebaseapp.com",
  projectId: "ashes-trac",
  storageBucket: "ashes-trac.firebasestorage.app",
  messagingSenderId: "1038049260529",
  appId: "1:1038049260529:web:401583810f6042562e8a50",
  measurementId: "G-B2D2W9Y0X7"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
        // --- App Logic ---
        window.app = {
            state: {
                user: null, // Firebase User
                profile: null, // Public Profile (Name, Score)
                logs: [],
                leaderboard: [],
                khatamPage: 0,
                quranActive: false,
                tasbihCount: 0
            },

            init: async function() {
                // 1. Auth Logic
                const initAuth = async () => {
                    try {
                        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                            await signInWithCustomToken(auth, __initial_auth_token);
                        } else {
                            await signInAnonymously(auth);
                        }
                    } catch (error) {
                        console.error("Auth Failed", error);
                        alert("Connection failed. Please refresh.");
                    }
                };
                await initAuth();

                // 2. Listen for Auth State
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        this.state.user = user;
                        this.setupRealtimeListeners(user.uid);
                    }
                });

                // 3. UI Setup
                this.setupUI();
            },

            setupRealtimeListeners: function(userId) {
                // A. Listen to MY Private Logs
                const logsRef = collection(db, 'artifacts', appId, 'users', userId, 'logs');
                onSnapshot(logsRef, (snapshot) => {
                    this.state.logs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    // Sort locally
                    this.state.logs.sort((a, b) => new Date(b.date) - new Date(a.date));
                    this.renderDashboard();
                    this.renderLogs();
                }, (error) => console.error("Logs sync error:", error));

                // B. Listen to Public Leaderboard (Everyone)
                const leaderboardRef = collection(db, 'artifacts', appId, 'public', 'data', 'leaderboard');
                onSnapshot(leaderboardRef, (snapshot) => {
                    this.state.leaderboard = snapshot.docs.map(doc => ({ uid: doc.id, ...doc.data() }));
                    
                    // Check if I exist in leaderboard to set profile/name
                    const myProfile = this.state.leaderboard.find(p => p.uid === userId);
                    if (myProfile) {
                        this.state.profile = myProfile;
                        this.state.khatamPage = myProfile.khatamPage || 0;
                        
                        // Update UI to logged-in state
                        document.getElementById('authScreen').classList.add('hidden');
                        document.getElementById('appScreen').classList.remove('hidden');
                        document.getElementById('appScreen').classList.add('fade-in');
                        document.getElementById('userDisplay').innerText = myProfile.name;
                        this.updateKhatamVisuals();
                    } else {
                        // User exists in Auth but hasn't set a name yet -> Show Login Screen
                        document.getElementById('authScreen').classList.remove('hidden');
                        document.getElementById('appScreen').classList.add('hidden');
                    }

                    this.renderLeaderboard();
                }, (error) => console.error("Leaderboard sync error:", error));
            },

            // --- Actions ---

            login: async function() {
                const name = document.getElementById('usernameInput').value.trim();
                if (!name) return alert("Please enter your name");
                
                if (!this.state.user) return alert("Connecting to server... please wait.");

                // Create initial profile in Public Leaderboard
                const userRef = doc(db, 'artifacts', appId, 'public', 'data', 'leaderboard', this.state.user.uid);
                await setDoc(userRef, {
                    name: name,
                    score: 0,
                    fasts: 0,
                    khatamPage: 0,
                    joinedAt: new Date().toISOString()
                }, { merge: true });

                // UI will update automatically via onSnapshot
            },

            logout: function() {
                if(confirm("Log out? You will need to clear browser data to sign in as a different anonymous user.")) {
                    auth.signOut();
                    location.reload();
                }
            },

            submitLog: async function() {
                if (!this.state.user) return;

                const date = document.getElementById('logDate').value;
                if(!date) return alert("Please select a date.");

                // Prevent duplicate dates? For now, we allow multiple logs or just append. 
                // Better: check if date exists in state.logs
                const existingLog = this.state.logs.find(l => l.date === date);
                if (existingLog) {
                    if(!confirm("You already have a log for this date. Overwrite it?")) return;
                    // We will delete the old one or just update. Let's delete old for simplicity.
                    await deleteDoc(doc(db, 'artifacts', appId, 'users', this.state.user.uid, 'logs', existingLog.id));
                }

                const fasted = document.getElementById('checkFast').checked;
                const sadaqah = document.getElementById('checkSadaqah').checked;
                const prayers = [];
                document.querySelectorAll('.prayer-check:checked').forEach(cb => prayers.push(cb.value));

                let quranData = null;
                if (this.state.quranActive) {
                    let surah = document.getElementById('surahSelect').value;
                    const verses = document.getElementById('versesCount').value;
                    const time = document.getElementById('readTime').value;
                    const translation = document.getElementById('checkTranslation').checked;
                    const reflection = document.getElementById('reflectionInput').value.trim();
                    
                    if(surah === 'Other') surah = document.getElementById('customSurahInput').value.trim();
                    if (!surah && (!verses || verses == 0)) return alert("Please specify Surah or Pages.");
                    
                    quranData = { surah, verses, time, translation, reflection };
                }

                // 1. Save Private Log
                await addDoc(collection(db, 'artifacts', appId, 'users', this.state.user.uid, 'logs'), {
                    date, fasted, sadaqah, prayers, quran: quranData, timestamp: new Date().toISOString()
                });

                // 2. Recalculate Totals for Public Leaderboard
                // We add the new log to current state to calculate BEFORE the snapshot updates (for speed)
                const tempLogs = [...this.state.logs.filter(l => l.date !== date), { fasted, sadaqah, prayers, quran: quranData }];
                this.updatePublicProfile(tempLogs, this.state.khatamPage);

                this.closeLogger();
                this.showToast("Progress Saved!");
            },

            deleteLog: async function(logId) {
                if(!confirm("Delete this entry?")) return;
                
                // 1. Delete Private Log
                await deleteDoc(doc(db, 'artifacts', appId, 'users', this.state.user.uid, 'logs', logId));
                
                // 2. Recalculate Totals
                const tempLogs = this.state.logs.filter(l => l.id !== logId);
                this.updatePublicProfile(tempLogs, this.state.khatamPage);
                
                this.showToast("Entry deleted");
            },

            saveKhatam: function() {
                const val = document.getElementById('khatamSlider').value;
                this.state.khatamPage = val;
                
                // Update Public Profile directly
                this.updatePublicProfile(this.state.logs, val);
                this.showToast("Khatam progress updated!");
            },

            updatePublicProfile: async function(currentLogs, currentKhatam) {
                const score = this.calculateTotalScore(currentLogs, currentKhatam);
                const fasts = currentLogs.filter(l => l.fasted).length;

                const userRef = doc(db, 'artifacts', appId, 'public', 'data', 'leaderboard', this.state.user.uid);
                await setDoc(userRef, {
                    score: score,
                    fasts: fasts,
                    khatamPage: parseInt(currentKhatam),
                    lastUpdated: new Date().toISOString()
                }, { merge: true });
            },

            // --- Calculations ---
            calculateTotalScore: function(logs, khatamPage) {
                let score = 0;
                logs.forEach(l => {
                    if (l.fasted) score += 50;
                    if (l.prayers) score += (l.prayers.length * 10);
                    if (l.sadaqah) score += 20;
                    if (l.quran) {
                        score += 20;
                        if (l.quran.translation) score += 15;
                    }
                });
                score += (parseInt(khatamPage || 0) * 2);
                return score;
            },

            calculateStreak: function(logs) {
                if (!logs || logs.length === 0) return 0;
                const dates = [...new Set(logs.map(l => l.date))].sort((a, b) => new Date(b) - new Date(a));
                const today = new Date().toISOString().split('T')[0];
                const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
                
                // Streak alive if logged today OR yesterday
                if (dates[0] !== today && dates[0] !== yesterday) return 0;

                let streak = 1;
                for (let i = 0; i < dates.length - 1; i++) {
                    const diffTime = Math.abs(new Date(dates[i]) - new Date(dates[i+1]));
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
                    if (diffDays === 1) streak++; else break;
                }
                return streak;
            },

            // --- UI Helpers ---
            setupUI: function() {
                // Populate Surahs
                const surahList = ["Al-Fatiha", "Al-Baqarah", "Al-Imran", "An-Nisa", "Al-Ma'idah", "Al-An'am", "Al-A'raf", "Al-Anfal", "At-Tawbah", "Yunus", "Hud", "Yusuf", "Ar-Ra'd", "Ibrahim", "Al-Hijr", "An-Nahl", "Al-Isra", "Al-Kahf", "Maryam", "Ta-Ha", "Al-Anbiya", "Al-Hajj", "Al-Mu'minun", "An-Nur", "Al-Furqan", "Ash-Shu'ara", "An-Naml", "Al-Qasas", "Al-Ankabut", "Ar-Rum", "Luqman", "As-Sajdah", "Al-Ahzab", "Saba", "Fatir", "Ya-Sin", "As-Saffat", "Sad", "Az-Zumar", "Ghafir", "Fussilat", "Ash-Shura", "Az-Zukhruf", "Ad-Dukhan", "Al-Jathiyah", "Al-Ahqaf", "Muhammad", "Al-Fath", "Al-Hujurat", "Qaf", "Adh-Dhariyat", "At-Tur", "An-Najm", "Al-Qamar", "Ar-Rahman", "Al-Waqi'ah", "Al-Hadid", "Al-Mujadila", "Al-Hashr", "Al-Mumtahanah", "As-Saff", "Al-Jumu'ah", "Al-Munafiqun", "At-Taghabun", "At-Talaq", "At-Tahrim", "Al-Mulk", "Al-Qalam", "Al-Haqqah", "Al-Ma'arij", "Nuh", "Al-Jinn", "Al-Muzzammil", "Al-Muddaththir", "Al-Qiyamah", "Al-Insan", "Al-Mursalat", "An-Naba", "An-Nazi'at", "Abasa", "At-Takwir", "Al-Infitar", "Al-Mutaffifin", "Al-Inshiqaq", "Al-Buruj", "At-Tariq", "Al-A'la", "Al-Ghashiyah", "Al-Fajr", "Al-Balad", "Ash-Shams", "Al-Layl", "Ad-Duhaa", "Ash-Sharh", "At-Tin", "Al-Alaq", "Al-Qadr", "Al-Bayyinah", "Az-Zalzalah", "Al-Adiyat", "Al-Qari'ah", "At-Takathur", "Al-Asr", "Al-Humazah", "Al-Fil", "Quraysh", "Al-Ma'un", "Al-Kawthar", "Al-Kafirun", "An-Nasr", "Al-Masad", "Al-Ikhlas", "Al-Falaq", "An-Nas"];
                const select = document.getElementById('surahSelect');
                select.innerHTML = '<option value="">Select Surah...</option>';
                surahList.forEach((s, i) => {
                    const opt = document.createElement('option');
                    opt.value = s;
                    opt.text = `${i+1}. ${s}`;
                    select.appendChild(opt);
                });
                const other = document.createElement('option'); other.value="Other"; other.text="Other"; select.appendChild(other);

                // Daily Verse
                const verses = [
                    { ar: "ÙÙØ¥ÙÙ†ÙÙ‘ Ù…ÙØ¹Ù Ù±Ù„Ù’Ø¹ÙØ³Ù’Ø±Ù ÙŠÙØ³Ù’Ø±Ù‹Ø§", en: "For indeed, with hardship [will be] ease. (94:5)" },
                    { ar: "Ù±Ù„Ù„ÙÙ‘Ù‡Ù Ù†ÙÙˆØ±Ù Ù±Ù„Ø³ÙÙ‘Ù…ÙÙ°ÙˆÙÙ°ØªÙ ÙˆÙÙ±Ù„Ù’Ø£ÙØ±Ù’Ø¶Ù", en: "Allah is the Light of the heavens and the earth. (24:35)" },
                    { ar: "Ù„ÙØ¦ÙÙ† Ø´ÙÙƒÙØ±Ù’ØªÙÙ…Ù’ Ù„ÙØ£ÙØ²ÙÙŠØ¯ÙÙ†ÙÙ‘ÙƒÙÙ…Ù’", en: "If you are grateful, I will surely increase you. (14:7)" }
                ];
                const rv = verses[Math.floor(Math.random() * verses.length)];
                document.getElementById('dailyArabic').innerText = rv.ar;
                document.getElementById('dailyEnglish').innerText = rv.en;

                // Set Today
                document.getElementById('logDate').value = new Date().toISOString().split('T')[0];

                // Input Listeners
                document.getElementById('surahSelect').addEventListener('change', (e) => {
                    document.getElementById('customSurahContainer').classList.toggle('hidden', e.target.value !== 'Other');
                });
                document.getElementById('reflectionInput').addEventListener('input', (e) => {
                    const c = e.target.value.length;
                    const el = document.getElementById('charCount');
                    el.innerText = `${c}/10 chars`;
                    el.style.color = c >= 10 ? '#34d399' : '#6b7280';
                });
            },

            updateKhatamVisuals: function() {
                const val = this.state.khatamPage;
                document.getElementById('khatamCurrentDisplay').innerText = val;
                document.getElementById('khatamSlider').value = val;
                const p = Math.round((val/604)*100);
                document.getElementById('khatamPercent').innerText = `${p}% Completed`;
                document.getElementById('khatamBar').style.width = `${p}%`;
            },

            renderDashboard: function() {
                const fasts = this.state.logs.filter(l => l.fasted).length;
                let prayers = 0;
                this.state.logs.forEach(l => prayers += (l.prayers ? l.prayers.length : 0));
                const totalPossible = this.state.logs.length * 5;
                const salahP = totalPossible > 0 ? Math.round((prayers/totalPossible)*100) : 0;
                const score = this.calculateTotalScore(this.state.logs, this.state.khatamPage);
                const streak = this.calculateStreak(this.state.logs);

                document.getElementById('statFasts').innerText = fasts;
                document.getElementById('statSalah').innerText = `${salahP}%`;
                document.getElementById('statStreak').innerText = streak;
                document.getElementById('statPoints').innerText = score.toLocaleString();
            },

            renderLeaderboard: function() {
                const tbody = document.getElementById('leaderboardBody');
                tbody.innerHTML = '';
                
                // Sort by Score
                const data = [...this.state.leaderboard].sort((a,b) => b.score - a.score);

                data.forEach((u, i) => {
                    const rank = i + 1;
                    const isMe = this.state.user && u.uid === this.state.user.uid;
                    let rankColor = 'text-gray-500';
                    let icon = '';
                    let rowClass = 'border-b border-gray-800/50 hover:bg-ashes-800/30 transition-colors';

                    if(rank === 1) { rankColor = 'text-gold-400 font-bold'; icon = '<i class="fas fa-crown text-gold-500 text-xs ml-2"></i>'; }
                    if(rank === 2) { rankColor = 'text-gray-300 font-bold'; }
                    if(rank === 3) { rankColor = 'text-orange-400 font-bold'; }
                    
                    if(isMe) rowClass = 'bg-gold-900/10 border-l-2 border-gold-500 border-b border-gray-800/50';

                    const html = `
                    <tr class="${rowClass}">
                        <td class="px-4 py-3 font-mono ${rankColor}">#${rank}</td>
                        <td class="px-4 py-3 font-medium text-white flex items-center">
                            ${u.name} ${icon}
                            ${isMe ? '<span class="text-[9px] bg-gold-600/20 text-gold-400 border border-gold-600/30 px-1.5 py-0.5 rounded ml-2 font-bold tracking-wider">YOU</span>' : ''}
                        </td>
                        <td class="px-4 py-3 text-center text-gray-400 text-xs font-mono">${u.fasts || 0}</td>
                        <td class="px-4 py-3 text-right font-mono text-gold-500 font-bold">${(u.score || 0).toLocaleString()}</td>
                    </tr>`;
                    tbody.insertAdjacentHTML('beforeend', html);
                });
            },

            renderLogs: function() {
                const container = document.getElementById('logsContainer');
                container.innerHTML = '';
                if(this.state.logs.length === 0) {
                    container.innerHTML = `<div class="glass-panel p-8 rounded-xl text-center border-dashed border border-gray-800 opacity-60"><i class="fas fa-scroll text-4xl text-gray-700 mb-3"></i><p class="text-gray-500 text-sm">Your legacy begins with the first log.</p></div>`;
                    return;
                }
                
                this.state.logs.forEach(log => {
                    const d = new Date(log.date);
                    const day = d.getDate();
                    const month = d.toLocaleString('default', {month:'short'});
                    
                    let quranBadge = '';
                    if(log.quran) quranBadge = `<div class="flex items-center gap-1 text-[10px] text-gold-400 bg-gold-900/20 px-2 py-1 rounded border border-gold-600/20"><i class="fas fa-quran"></i> ${log.quran.surah || 'Read'}</div>`;
                    
                    let charityBadge = '';
                    if(log.sadaqah) charityBadge = `<div class="flex items-center gap-1 text-[10px] text-emerald-400 bg-emerald-900/20 px-2 py-1 rounded border border-emerald-600/20"><i class="fas fa-hand-holding-heart"></i> Charity</div>`;

                    const html = `
                    <div class="glass-panel p-4 rounded-xl border-l-2 ${log.fasted ? 'border-l-gold-500' : 'border-l-gray-700'} flex flex-col gap-2 transition-all hover:bg-ashes-800/40 group">
                        <div class="flex justify-between items-start">
                            <div class="flex items-center gap-4">
                                <div class="bg-ashes-900/80 w-12 h-12 rounded-lg flex flex-col items-center justify-center border border-gray-800 shadow-inner">
                                    <span class="text-[9px] text-gray-500 uppercase font-bold tracking-wider">${month}</span>
                                    <span class="text-xl font-bold text-white leading-none font-serif">${day}</span>
                                </div>
                                <div>
                                    <div class="flex gap-2 mb-1 items-center flex-wrap">
                                        ${log.fasted ? '<span class="text-[9px] font-bold bg-emerald-900/30 text-emerald-400 px-2 py-0.5 rounded border border-emerald-900/50">FASTED</span>' : '<span class="text-[9px] font-bold bg-gray-800 text-gray-500 px-2 py-0.5 rounded">NOT FASTED</span>'}
                                        ${quranBadge} ${charityBadge}
                                    </div>
                                    <div class="text-emerald-400 text-xs font-bold flex items-center gap-1.5">
                                        <i class="fas fa-pray"></i> ${log.prayers ? log.prayers.length : 0}/5 Prayers
                                    </div>
                                </div>
                            </div>
                            <button onclick="app.deleteLog('${log.id}')" class="text-gray-700 hover:text-red-500 transition-colors p-2 opacity-0 group-hover:opacity-100"><i class="fas fa-trash-alt"></i></button>
                        </div>
                        ${log.quran && log.quran.reflection ? `<div class="mt-2 pl-3 border-l border-gray-700"><p class="text-[9px] text-gold-600 uppercase font-bold mb-0.5 tracking-wider">Reflection</p><p class="text-xs text-gray-300 italic line-clamp-2">"${log.quran.reflection}"</p></div>` : ''}
                    </div>`;
                    container.insertAdjacentHTML('beforeend', html);
                });
            },

            // --- Simple Interactions ---
            openLogger: function() {
                document.getElementById('logModal').classList.remove('hidden');
                // Reset Fields
                document.getElementById('checkFast').checked = false;
                document.getElementById('checkSadaqah').checked = false;
                document.querySelectorAll('.prayer-check').forEach(c => c.checked = false);
                this.toggleQuran(false);
                document.getElementById('checkTranslation').checked = false;
                this.toggleTranslation();
                document.getElementById('versesCount').value = '';
                document.getElementById('reflectionInput').value = '';
                document.getElementById('surahSelect').value = '';
            },
            closeLogger: function() { document.getElementById('logModal').classList.add('hidden'); },
            toggleQuran: function(active) {
                this.state.quranActive = active;
                const d = document.getElementById('quranDetails');
                const y = document.getElementById('btnQuranYes');
                const n = document.getElementById('btnQuranNo');
                if(active) {
                    d.classList.remove('hidden');
                    y.className = "px-5 py-2 rounded-lg text-xs font-bold bg-gold-600 text-black shadow-lg";
                    n.className = "px-5 py-2 rounded-lg text-xs font-bold bg-ashes-800 border border-gray-700 text-gray-500";
                } else {
                    d.classList.add('hidden');
                    n.className = "px-5 py-2 rounded-lg text-xs font-bold bg-gray-700 text-white shadow-lg";
                    y.className = "px-5 py-2 rounded-lg text-xs font-bold bg-ashes-800 border border-gray-700 text-gray-500";
                }
            },
            toggleTranslation: function() {
                const c = document.getElementById('checkTranslation').checked;
                const v = document.getElementById('verificationSection');
                if(c) { v.classList.remove('hidden'); v.classList.add('fade-in'); } else { v.classList.add('hidden'); }
            },
            showToast: function(msg) {
                const t = document.getElementById('toast');
                document.getElementById('toastMsg').innerText = msg;
                t.classList.remove('translate-x-full');
                setTimeout(() => t.classList.add('translate-x-full'), 3000);
            },
            scrollToSection: function(id) {
                document.getElementById(id).scrollIntoView({behavior:'smooth'});
            },
            openTasbih: function() { document.getElementById('tasbihModal').classList.remove('hidden'); this.state.tasbihCount=0; document.getElementById('tasbihCount').innerText=0; },
            closeTasbih: function() { document.getElementById('tasbihModal').classList.add('hidden'); },
            tasbihClick: function() { this.state.tasbihCount++; document.getElementById('tasbihCount').innerText=this.state.tasbihCount; if(navigator.vibrate) navigator.vibrate(20); },
            tasbihReset: function() { if(confirm("Reset?")) { this.state.tasbihCount=0; document.getElementById('tasbihCount').innerText=0; } },
            openDuas: function() { document.getElementById('duasModal').classList.remove('hidden'); },
            closeDuas: function() { document.getElementById('duasModal').classList.add('hidden'); }
        };

        // Boot
        document.addEventListener('DOMContentLoaded', () => window.app.init());
    </script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        ashes: { 950: '#050505', 900: '#121212', 800: '#1e1e1e', 700: '#2d2d2d' },
                        gold: { 400: '#fbbf24', 500: '#f59e0b', 600: '#d97706' },
                        emerald: { 400: '#34d399', 500: '#10b981', 900: '#064e3b' }
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'], serif: ['Amiri', 'serif'], arabic: ['Reem Kufi', 'sans-serif'] },
                    animation: { 'spin-slow': 'spin 15s linear infinite', 'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite' }
                }
            }
        }
    </script>
</head>
<body class="min-h-screen relative overflow-x-hidden selection:bg-gold-500 selection:text-black bg-ashes-950 text-gray-200">

    <!-- Background -->
    <div class="fixed inset-0 islamic-pattern pointer-events-none z-0"></div>
    <div class="fixed top-0 left-0 right-0 h-48 bg-gradient-to-b from-gold-600/10 via-ashes-950/50 to-transparent pointer-events-none z-0"></div>

    <!-- Auth Screen -->
    <div id="authScreen" class="relative z-10 flex flex-col items-center justify-center min-h-screen p-6">
        <div class="glass-panel p-10 rounded-3xl shadow-2xl max-w-sm w-full text-center border border-gold-600/30 gold-glow">
            <div class="mb-8">
                <!-- LOGO PLACEHOLDER -->
                <div class="w-32 h-32 mx-auto rounded-full border border-gold-500/30 bg-black/40 flex items-center justify-center relative mb-4">
                    <i class="fas fa-fire text-5xl text-gold-500"></i>
                    <div class="absolute inset-0 rounded-full border-2 border-dashed border-gold-500/20 animate-spin-slow"></div>
                </div>
                <h1 class="text-5xl font-serif font-bold text-white tracking-widest">ASHES</h1>
                <p class="text-gray-400 text-[10px] tracking-[0.3em] uppercase mt-2">Ramadan Legacy Tracker</p>
            </div>
            <div class="space-y-4">
                <input type="text" id="usernameInput" placeholder="Enter Your Name" class="w-full bg-ashes-900 border border-gray-700 rounded-xl px-5 py-4 text-white focus:border-gold-500 outline-none text-center">
                <button onclick="app.login()" class="w-full bg-gradient-to-r from-gold-600 to-gold-500 hover:to-gold-400 text-black font-bold py-4 rounded-xl shadow-lg transition-all">ENTER PORTAL</button>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="appScreen" class="relative z-10 hidden pb-24">
        
        <header class="bg-ashes-950/80 backdrop-blur-xl border-b border-gray-800/50 sticky top-0 z-40 shadow-lg">
            <div class="max-w-4xl mx-auto px-4 py-3 flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-ashes-800 rounded-full flex items-center justify-center border border-gold-600/30"><i class="fas fa-fire text-gold-500 text-sm"></i></div>
                    <div>
                        <h2 class="font-bold text-white leading-none tracking-widest font-serif">ASHES</h2>
                        <p class="text-[9px] text-gold-500 uppercase tracking-widest" id="userDisplay">MEMBER</p>
                    </div>
                </div>
                <div class="flex gap-2">
                    <button onclick="app.scrollToSection('leaderboardSection')" class="text-gray-400 hover:text-gold-400 bg-ashes-800/50 p-2.5 rounded-lg"><i class="fas fa-trophy"></i></button>
                    <button onclick="app.logout()" class="text-gray-400 hover:text-red-400 bg-ashes-800/50 p-2.5 rounded-lg"><i class="fas fa-power-off"></i></button>
                </div>
            </div>
        </header>

        <main class="max-w-4xl mx-auto px-4 py-6 space-y-6">
            
            <!-- Tools -->
            <div class="grid grid-cols-2 gap-3">
                <button onclick="app.openTasbih()" class="glass-panel p-4 rounded-xl flex items-center justify-between group hover:bg-ashes-800/50 transition-all cursor-pointer">
                    <div class="text-left"><p class="text-[10px] text-gray-500 uppercase font-bold">Tool</p><h4 class="text-white font-serif font-bold">Tasbih</h4></div>
                    <i class="fas fa-fingerprint text-gold-500 text-2xl group-hover:scale-110 transition-transform"></i>
                </button>
                <button onclick="app.openDuas()" class="glass-panel p-4 rounded-xl flex items-center justify-between group hover:bg-ashes-800/50 transition-all cursor-pointer">
                    <div class="text-left"><p class="text-[10px] text-gray-500 uppercase font-bold">Library</p><h4 class="text-white font-serif font-bold">Duas</h4></div>
                    <i class="fas fa-praying-hands text-emerald-400 text-2xl group-hover:scale-110 transition-transform"></i>
                </button>
            </div>

            <!-- Verse -->
            <div class="glass-panel p-6 rounded-2xl text-center border-t border-gold-600/50 relative overflow-hidden">
                <div class="absolute -top-10 -right-10 w-40 h-40 bg-gold-600/10 rounded-full blur-3xl"></div>
                <span class="inline-block px-3 py-1 rounded-full bg-gold-900/30 border border-gold-600/30 text-[10px] text-gold-400 uppercase tracking-wider mb-3">Daily Verse</span>
                <p class="font-arabic text-2xl text-white mb-2" id="dailyArabic">Loading...</p>
                <p class="text-gray-400 text-sm italic" id="dailyEnglish">Loading...</p>
            </div>

            <!-- Stats -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                <div class="glass-panel p-4 rounded-xl text-center"><p class="text-2xl font-bold text-white" id="statFasts">0</p><p class="text-[10px] text-gray-500 uppercase">Fasts</p></div>
                <div class="glass-panel p-4 rounded-xl text-center"><p class="text-2xl font-bold text-emerald-400" id="statSalah">0%</p><p class="text-[10px] text-gray-500 uppercase">Salah</p></div>
                <div class="glass-panel p-4 rounded-xl text-center"><p class="text-2xl font-bold text-orange-400" id="statStreak">0</p><p class="text-[10px] text-gray-500 uppercase">Streak</p></div>
                <div class="glass-panel p-4 rounded-xl text-center"><p class="text-2xl font-bold text-gold-500" id="statPoints">0</p><p class="text-[10px] text-gray-500 uppercase">Score</p></div>
            </div>

            <button onclick="app.openLogger()" class="w-full bg-gradient-to-r from-ashes-800 to-ashes-900 border border-gold-600/30 hover:border-gold-500 p-6 rounded-2xl flex items-center justify-between group transition-all shadow-lg">
                <div class="text-left"><h3 class="text-xl font-serif font-bold text-white">Log Progress</h3><p class="text-sm text-gray-400">Record Salah, Fasting, Quran</p></div>
                <div class="w-12 h-12 bg-gold-600 rounded-full flex items-center justify-center text-black shadow-lg group-hover:scale-110 transition-transform"><i class="fas fa-plus text-xl"></i></div>
            </button>

            <!-- Khatam -->
            <div class="glass-panel p-6 rounded-2xl border border-gray-800 relative overflow-hidden">
                <div class="flex justify-between items-end mb-4">
                    <div><h3 class="text-gold-500 font-bold text-lg"><i class="fas fa-book-open mr-2"></i> Khatam Tracker</h3><p class="text-xs text-gray-400">Goal: 604 Pages</p></div>
                    <div class="text-right"><div class="text-2xl font-bold text-white"><span id="khatamCurrentDisplay">0</span><span class="text-gray-600 text-lg">/604</span></div><div class="text-[10px] text-emerald-500 font-bold uppercase" id="khatamPercent">0%</div></div>
                </div>
                <div class="relative h-3 bg-black/50 rounded-full overflow-hidden mb-6 border border-gray-700/50"><div id="khatamBar" class="absolute top-0 left-0 h-full bg-emerald-500 transition-all duration-1000" style="width: 0%"></div></div>
                <div class="flex items-center gap-4 bg-ashes-900/50 p-3 rounded-xl border border-gray-800">
                    <span class="text-[10px] text-gray-500 font-bold uppercase">Pg 1</span>
                    <input type="range" min="0" max="604" value="0" id="khatamSlider" class="w-full" oninput="app.updateKhatamVisuals()">
                    <span class="text-[10px] text-gray-500 font-bold uppercase">Pg 604</span>
                </div>
                <div class="flex justify-end mt-3"><button onclick="app.saveKhatam()" class="text-xs bg-ashes-800 hover:bg-gold-600 hover:text-black text-gold-500 border border-gold-600/30 px-4 py-2 rounded-lg transition-all font-bold">Update</button></div>
            </div>

            <!-- Leaderboard -->
            <div id="leaderboardSection" class="glass-panel p-6 rounded-2xl border border-gold-600/20">
                <div class="flex justify-between items-center mb-6">
                    <div><h3 class="text-white font-bold text-lg uppercase tracking-wider font-serif">Team Standings</h3><p class="text-xs text-gray-400">Live Rankings</p></div>
                    <div class="bg-ashes-900/80 px-3 py-1.5 rounded-lg border border-gold-600/20"><span class="text-xs text-gold-500 font-bold"><i class="fas fa-crown mr-1"></i> Leaderboard</span></div>
                </div>
                <div class="overflow-hidden rounded-xl border border-gray-800">
                    <table class="w-full text-left text-sm"><thead class="bg-ashes-900 text-gray-500 uppercase text-[10px] font-bold"><tr><th class="px-4 py-3">Rank</th><th class="px-4 py-3">Member</th><th class="px-4 py-3 text-center">Fasts</th><th class="px-4 py-3 text-right">Score</th></tr></thead>
                    <tbody id="leaderboardBody" class="divide-y divide-gray-800 bg-ashes-900/40"></tbody></table>
                </div>
            </div>

            <!-- History -->
            <div><div class="flex justify-between items-end mb-4 px-1"><h3 class="text-gold-500/70 text-xs font-bold uppercase tracking-wider">History</h3></div><div id="logsContainer" class="space-y-3"></div></div>
        </main>
    </div>

    <!-- Modals (Tasbih, Duas, Logger) remain same structure, just hidden initially -->
    <div id="tasbihModal" class="fixed inset-0 z-50 hidden"><div class="absolute inset-0 bg-black/95 backdrop-blur-md" onclick="app.closeTasbih()"></div><div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-[90%] max-w-sm glass-panel p-8 rounded-3xl border border-gold-600/30 text-center"><h3 class="text-gold-500 font-serif text-2xl font-bold mb-1">Tasbih</h3><div class="bg-black/40 rounded-full w-48 h-48 mx-auto flex items-center justify-center border-4 border-gray-800 mb-6"><span id="tasbihCount" class="text-6xl font-mono font-bold text-white">0</span></div><button onclick="app.tasbihClick()" class="w-full bg-emerald-600 text-white font-bold py-4 rounded-xl shadow-lg mb-3 text-lg">COUNT</button><button onclick="app.tasbihReset()" class="text-xs text-gray-500">RESET</button></div></div>

    <div id="duasModal" class="fixed inset-0 z-50 hidden"><div class="absolute inset-0 bg-black/95 backdrop-blur-md" onclick="app.closeDuas()"></div><div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-[90%] max-w-md h-[80vh] glass-panel rounded-3xl border border-gray-800 flex flex-col"><div class="p-5 border-b border-gray-800 flex justify-between items-center"><h3 class="text-white font-serif text-xl font-bold">Duas</h3><button onclick="app.closeDuas()" class="text-gray-500 hover:text-white"><i class="fas fa-times"></i></button></div><div class="p-6 overflow-y-auto space-y-6 flex-1"><div class="bg-ashes-900/50 p-4 rounded-xl border border-gray-700/50"><p class="text-[10px] text-gold-500 uppercase font-bold mb-2">Iftar</p><p class="font-arabic text-xl text-right mb-2">Ø§Ù„Ù„Ù‘ÙÙ‡ÙÙ…Ù‘Ù Ù„ÙÙƒÙ ØµÙÙ…Ù’ØªÙ ÙˆÙØ¹ÙÙ„ÙÙ‰ Ø±ÙØ²Ù’Ù‚ÙÙƒÙ Ø£ÙÙÙ’Ø·ÙØ±Ù’ØªÙ</p></div><div class="bg-ashes-900/50 p-4 rounded-xl border border-gray-700/50"><p class="text-[10px] text-gold-500 uppercase font-bold mb-2">Suhoor</p><p class="font-arabic text-xl text-right mb-2">ÙˆÙØ¨ÙØµÙÙˆÙ’Ù…Ù ØºÙØ¯Ù Ù†ÙÙ‘ÙˆÙÙŠÙ’ØªÙ Ù…ÙÙ†Ù’ Ø´ÙÙ‡Ù’Ø±Ù Ø±ÙÙ…ÙØ¶ÙØ§Ù†Ù</p></div></div></div></div>

    <div id="logModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/95 backdrop-blur-md" onclick="app.closeLogger()"></div>
        <div class="absolute bottom-0 md:top-1/2 md:left-1/2 md:transform md:-translate-x-1/2 md:-translate-y-1/2 md:bottom-auto w-full md:w-[500px] md:rounded-2xl bg-[#0f0f0f] border border-gray-800 shadow-2xl flex flex-col max-h-[90vh]">
            <div class="p-5 border-b border-gray-800 flex justify-between items-center bg-ashes-900/50 rounded-t-2xl"><div><h3 class="font-serif text-xl font-bold text-gold-500">Log Day</h3></div><button onclick="app.closeLogger()" class="text-gray-400 hover:text-white"><i class="fas fa-times"></i></button></div>
            <div class="overflow-y-auto p-6 space-y-6 flex-1 custom-scrollbar">
                <div><label class="block text-gray-500 text-[10px] uppercase font-bold mb-2">Date</label><input type="date" id="logDate" class="w-full bg-ashes-900 border border-gray-800 rounded-xl p-4 text-white outline-none"></div>
                <div class="space-y-4">
                    <h4 class="text-white font-bold text-sm border-b border-gray-800 pb-2">Obligations</h4>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="p-4 bg-ashes-800/30 rounded-xl border border-gray-700/30 flex items-center justify-between"><span class="text-gray-300 text-sm font-bold">Fasting?</span><input type="checkbox" id="checkFast" class="w-5 h-5 accent-gold-500"></div>
                        <div class="p-4 bg-ashes-800/30 rounded-xl border border-gray-700/30 flex items-center justify-between"><span class="text-gray-300 text-sm font-bold">Charity?</span><input type="checkbox" id="checkSadaqah" class="w-5 h-5 accent-emerald-500"></div>
                    </div>
                    <div><label class="block text-gray-500 text-[10px] uppercase font-bold mb-3 text-center">Prayers</label><div class="grid grid-cols-5 gap-2"><label class="cursor-pointer"><input type="checkbox" class="peer sr-only prayer-check" value="Fajr"><div class="h-10 w-full rounded bg-ashes-800 border border-gray-700 flex items-center justify-center text-gray-500 peer-checked:bg-emerald-900/30 peer-checked:text-emerald-400 text-[9px] font-bold">Fajr</div></label><label class="cursor-pointer"><input type="checkbox" class="peer sr-only prayer-check" value="Dhuhr"><div class="h-10 w-full rounded bg-ashes-800 border border-gray-700 flex items-center justify-center text-gray-500 peer-checked:bg-emerald-900/30 peer-checked:text-emerald-400 text-[9px] font-bold">Dhuhr</div></label><label class="cursor-pointer"><input type="checkbox" class="peer sr-only prayer-check" value="Asr"><div class="h-10 w-full rounded bg-ashes-800 border border-gray-700 flex items-center justify-center text-gray-500 peer-checked:bg-emerald-900/30 peer-checked:text-emerald-400 text-[9px] font-bold">Asr</div></label><label class="cursor-pointer"><input type="checkbox" class="peer sr-only prayer-check" value="Maghrib"><div class="h-10 w-full rounded bg-ashes-800 border border-gray-700 flex items-center justify-center text-gray-500 peer-checked:bg-emerald-900/30 peer-checked:text-emerald-400 text-[9px] font-bold">Mag</div></label><label class="cursor-pointer"><input type="checkbox" class="peer sr-only prayer-check" value="Isha"><div class="h-10 w-full rounded bg-ashes-800 border border-gray-700 flex items-center justify-center text-gray-500 peer-checked:bg-emerald-900/30 peer-checked:text-emerald-400 text-[9px] font-bold">Isha</div></label></div></div>
                </div>
                <div class="space-y-4">
                    <h4 class="text-white font-bold text-sm border-b border-gray-800 pb-2">Quran</h4>
                    <div class="flex items-center gap-2 mb-4 bg-ashes-900 p-2 rounded-xl border border-gray-800"><span class="text-gray-300 text-sm flex-1 pl-2">Read Quran?</span><div class="flex gap-2"><button onclick="app.toggleQuran(true)" id="btnQuranYes" class="px-5 py-2 rounded-lg text-xs font-bold bg-ashes-800 border border-gray-700 text-gray-400">Yes</button><button onclick="app.toggleQuran(false)" id="btnQuranNo" class="px-5 py-2 rounded-lg text-xs font-bold bg-ashes-800 border border-gray-700 text-gray-400">No</button></div></div>
                    <div id="quranDetails" class="hidden space-y-4 bg-ashes-800/20 p-5 rounded-xl border border-gold-600/20">
                        <div><label class="block text-gray-500 text-[10px] uppercase font-bold mb-2">Surah</label><select id="surahSelect" class="w-full bg-ashes-900 border border-gray-700 rounded-xl p-3 text-white text-sm outline-none"></select><div id="customSurahContainer" class="hidden mt-2"><input type="text" id="customSurahInput" placeholder="Type Name..." class="w-full bg-ashes-900 border border-gold-600/50 rounded-xl p-3 text-white text-sm outline-none"></div></div>
                        <div class="grid grid-cols-2 gap-3"><div><label class="block text-gray-500 text-[10px] uppercase font-bold mb-2">Pages</label><input type="number" id="versesCount" class="w-full bg-ashes-900 border border-gray-700 rounded-xl p-3 text-white text-sm outline-none"></div><div><label class="block text-gray-500 text-[10px] uppercase font-bold mb-2">Time</label><select id="readTime" class="w-full bg-ashes-900 border border-gray-700 rounded-xl p-3 text-white text-sm outline-none"><option value="Fajr">Fajr</option><option value="Noon">Noon</option><option value="Taraweeh">Taraweeh</option></select></div></div>
                        <div class="bg-gradient-to-br from-ashes-950 to-black p-4 rounded-xl border border-gold-900/30"><label class="flex items-center cursor-pointer"><input type="checkbox" id="checkTranslation" class="w-4 h-4 accent-gold-500" onchange="app.toggleTranslation()"><span class="ml-2 text-sm text-gold-400 font-bold">Read Translation</span></label><div id="verificationSection" class="hidden mt-3 pt-3 border-t border-gray-800"><label class="block text-xs text-emerald-400 mb-2 font-bold">Reflection</label><textarea id="reflectionInput" rows="2" class="w-full bg-ashes-900/50 border border-gray-700 rounded-lg p-3 text-sm text-white outline-none"></textarea><p class="text-[9px] text-gray-500 mt-1 text-right" id="charCount">0/10</p></div></div>
                    </div>
                </div>
            </div>
            <div class="p-5 border-t border-gray-800 bg-ashes-900/80 rounded-b-2xl"><button onclick="app.submitLog()" class="w-full bg-gradient-to-r from-gold-600 to-gold-500 text-black font-bold py-4 rounded-xl shadow-lg">SAVE RECORD</button></div>
        </div>
    </div>

    <div id="toast" class="fixed top-5 right-5 z-50 transform translate-x-full transition-transform duration-300"><div class="bg-ashes-800 border-l-4 border-gold-500 text-white px-6 py-4 rounded-lg shadow-2xl flex items-center border border-gray-700/50"><i class="fas fa-check-circle text-gold-500 mr-3 text-xl"></i><div><h4 class="font-bold text-sm text-white">Success</h4><p class="text-xs text-gray-400" id="toastMsg">Action completed</p></div></div></div>

</body>
</html>
